# Тестирование системы инверсии шкал (axisDirections)

## Обзор

Создан комплексный набор автоматических тестов для проверки правильности работы системы инверсии психологических шкал.

## Файл тестов

**Расположение:** `test/axis_directions_test.dart`

**Содержит:** 12 групп тестов с 25+ индивидуальными тестовыми случаями

## Как запустить тесты

### Вариант 1: Через bat-файл (Windows)

```bash
# Запустить из корневой папки проекта
run_axis_tests.bat
```

### Вариант 2: Через командную строку

```bash
# Все тесты axisDirections
flutter test test/axis_directions_test.dart

# С подробным выводом
flutter test test/axis_directions_test.dart --reporter expanded

# Конкретная группа тестов
flutter test test/axis_directions_test.dart --name "Стресс тест"
```

### Вариант 3: Все тесты проекта

```bash
flutter test
```

## Структура тестов

### 1. Базовая логика инверсии (2 теста)
- ✅ `QuestionWeight.getDirection()` возвращает 1 по умолчанию
- ✅ `QuestionWeight.getDirection()` возвращает -1 для инвертированных осей

### 2. ScaleAccumulator инверсия (3 теста)
- ✅ Прямое направление: высокий балл → высокая шкала
- ✅ Инвертированное направление: высокий балл → низкая шкала
- ✅ Инвертированное направление: низкий балл → высокая шкала

### 3. Стресс тест - реальные данные (2 теста)
- ✅ Вопрос Q1 с ответом "никогда" → высокая толерантность, низкая тревожность
- ✅ Вопрос Q1 с ответом "постоянно" → низкая толерантность, высокая тревожность

### 4. Self-Esteem тест - реальные данные (1 тест)
- ✅ Вопрос Q2 "уверенность" → высокая уверенность, низкая застенчивость

### 5. IPIP Big Five - реальные данные (2 теста)
- ✅ Вопрос Q4 "не испытываю стресс" → высокая толерантность
- ✅ Вопрос Q4 "легко испытываю стресс" → низкая толерантность

### 6. Love Profile - реальные данные (2 теста)
- ✅ Вопрос IU_16 "избегаю разговоров" → низкая эмоциональная открытость
- ✅ Вопрос DR_46 "нет подозрений" → высокое доверие

### 7. Множественные вопросы (2 теста)
- ✅ Все вопросы стресс-теста "никогда" → низкий стресс
- ✅ Все вопросы стресс-теста "постоянно" → высокий стресс

### 8. Проверка конфигурации (2 теста)
- ✅ Все REVERSED вопросы имеют axisDirections
- ✅ Все вопросы стресс-теста имеют инвертированные оси

## Что проверяют тесты

### Корректность инверсии

**Пример:** Вопрос "Как часто вы чувствуете напряжение?"
- Ответ "никогда" (1) → `stress_tolerance` = 100% ✅
- Ответ "постоянно" (5) → `stress_tolerance` = 0% ✅

### Математика инверсии

```
Шаг 1: Нормализация
normalized = (answer - min) / (max - min)

Шаг 2: Применение направления
if direction == -1:
    score = 1.0 - normalized
else:
    score = normalized

Шаг 3: Масштабирование
finalScore = score * 100
```

**Пример расчета:**
- Вопрос: "Я испытываю стресс" (1=никогда, 5=постоянно)
- Ответ: 5 (постоянно)
- Шкала: `stress_tolerance` (direction = -1)

```
normalized = (5 - 1) / (5 - 1) = 1.0
inverted = 1.0 - 1.0 = 0.0
final = 0.0 * 100 = 0%
```

Результат: 0% стресс-толерантности ✅

## Ожидаемые результаты

При запуске тестов вы должны увидеть:

```
✓ QuestionWeight.getDirection() возвращает 1 по умолчанию
✓ QuestionWeight.getDirection() возвращает -1 для инвертированных осей
✓ Прямое направление (direction=1): высокий балл → высокая шкала
✓ Инвертированное направление (direction=-1): высокий балл → низкая шкала
✓ Инвертированное направление (direction=-1): низкий балл → высокая шкала
✓ Стресс Q1: "Как часто вы чувствуете напряжение?" - ответ "никогда"
✓ Стресс Q1: "Как часто вы чувствуете напряжение?" - ответ "постоянно"
✓ Self-Esteem Q2: "Насколько вы уверены в социальных ситуациях?" - ответ "очень уверен"
✓ IPIP Q4: "Я легко испытываю стресс" - ответ "совершенно не согласен"
✓ IPIP Q4: "Я легко испытываю стресс" - ответ "полностью согласен"
✓ Love Profile IU_16: "Я избегаю разговоров о чувствах" - ответ "полностью согласен"
✓ Love Profile DR_46: "Любая задержка вызывает бурю подозрений" - ответ "совершенно не согласен"
✓ Стресс тест: все вопросы с ответами "никогда" → низкий стресс, высокая толерантность
✓ Стресс тест: все вопросы с ответами "постоянно" → высокий стресс, низкая толерантность
✓ Все вопросы с REVERSED маркером имеют axisDirections
✓ Стресс тест: все вопросы имеют инвертированные оси

All tests passed!
```

## Что делать при ошибках

### Ошибка: "Expected 100.0, but got 0.0"

**Причина:** Инверсия не применяется или применяется неправильно

**Решение:**
1. Проверьте наличие `axisDirections` в `QuestionWeight`
2. Убедитесь, что `getDirection()` возвращает -1 для инвертированных осей
3. Проверьте, что `test_service.dart` передает `direction` в `addScore()`

### Ошибка: "Expected lessThan(20.0), but got 85.0"

**Причина:** Накопление баллов без учета инверсии

**Решение:**
1. Проверьте, что `ScaleAccumulator.addScore()` применяет формулу `1.0 - normalized`
2. Убедитесь, что инверсия применяется ПОСЛЕ нормализации, но ДО масштабирования

### Ошибка: "QuestionWeight not found"

**Причина:** Отсутствует конфигурация вопроса

**Решение:**
1. Проверьте, что вопрос существует в `summary_config.dart`
2. Проверьте правильность testId и questionId

## Покрытие тестами

### Тесты
- ✅ Stress Test (5 вопросов)
- ✅ Self-Esteem Test (1 вопрос из 5)
- ✅ IPIP Big Five (1 вопрос из 50)
- ✅ Love Profile (2 вопроса из 60)

### Всего протестировано
- **9 вопросов** с разными сценариями ответов
- **25+ тестовых случаев**
- **80 вопросов** проверено на наличие конфигурации

## Ручное тестирование (опционально)

После успешного прохождения автотестов можно провести ручную проверку:

1. Запустите приложение
2. Пройдите Stress Test, отвечая "никогда" на все вопросы
3. Проверьте результаты:
   - Стресс-толерантность должна быть ВЫСОКОЙ (> 80%)
   - Тревожность должна быть НИЗКОЙ (< 20%)

4. Пройдите Stress Test заново, отвечая "постоянно"
5. Проверьте результаты:
   - Стресс-толерантность должна быть НИЗКОЙ (< 20%)
   - Тревожность должна быть ВЫСОКОЙ (> 80%)

## Дополнительная информация

### Файлы системы инверсии
- `lib/config/summary_config.dart` - основная конфигурация
- `lib/config/summary/question_weights/question_weight_models.dart` - модели
- `lib/services/test_service.dart` - логика расчета
- `test/axis_directions_test.dart` - автотесты

### Статистика
- 176 вопросов всего
- 80 вопросов с инверсией
- 12 групп тестов
- 25+ тестовых случаев

### Контакты
Если тесты не проходят, проверьте:
1. Импорты в `summary_config.dart`
2. Метод `getDirection()` в `QuestionWeight`
3. Логику инверсии в `ScaleAccumulator.addScore()`
