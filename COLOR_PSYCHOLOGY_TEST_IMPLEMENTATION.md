# Реализация теста "Цветовая психология"

## Обзор
Тест "Цветовая психология" - это специальный психологический тест с нестандартным интерфейсом, который диагностирует эмоциональное состояние через цветовые предпочтения.

## Особенности реализации
- **Нестандартный UI**: Использует собственный экран `ColorPsychologyTestScreen` вместо стандартного `TestScreen`
- **3 этапа тестирования**:
  1. Быстрый выбор (30 секунд) - выбор 3 любимых и 3 нелюбимых цветов
  2. Ранжирование (60 секунд) - drag-and-drop сортировка всех 10 цветов
  3. Ассоциации - сопоставление цветов с аспектами жизни
- **8 психологических шкал**: энергия, стресс, баланс, открытость, контроль, удовлетворённость, защита, потребность в изменениях
- **Выявление паттернов**: выгорание, тревога, депрессия, гармония и др.

## Созданные файлы

### 1. Модели данных
- `/lib/models/color_psychology_model.dart` - структуры данных для теста
  - `ColorInfo` - информация о цвете
  - `QuickChoiceResult` - результат быстрого выбора
  - `ColorRankingResult` - результат ранжирования
  - `ColorAssociationResult` - результат ассоциаций
  - `ColorPsychologyResult` - полный результат теста

### 2. Данные теста
- `/lib/data/color_psychology_data.dart` - данные о 10 цветах и их психологических значениях
- `/lib/data/tests/color_psychology_test.dart` - test stub для интеграции

### 3. UI компоненты
- `/lib/screens/color_psychology_test_screen.dart` - главный экран теста
- `/lib/widgets/color_selection_widget.dart` - виджет быстрого выбора (этап 1)
- `/lib/widgets/color_ranking_widget.dart` - виджет ранжирования с drag-and-drop (этап 2)
- `/lib/widgets/color_association_widget.dart` - виджет ассоциаций (этап 3)
- `/lib/screens/color_psychology_result_screen.dart` - экран результатов

### 4. Бизнес-логика
- `/lib/services/color_psychology_service.dart` - сервис для расчета результатов

## Интеграция с приложением

### 1. В test_registry.dart
```dart
import 'tests/color_psychology_test.dart';

// В списке allTests:
ColorPsychologyTest(), // Special color-based test
```

### 2. В test_loader_service.dart
```dart
import '../data/tests/color_psychology_test.dart';

// В методе _loadLegacyTest:
case 'color_psychology_v1':
  test = ColorPsychologyTest.getColorPsychologyTest();
  break;
```

### 3. В home_screen.dart
```dart
import 'color_psychology_test_screen.dart';

// В методе onTap:
if (test.id == 'color_psychology_v1') {
  Navigator.push(
    context,
    MaterialPageRoute(
      builder: (context) => const ColorPsychologyTestScreen(),
    ),
  );
}
```

## Особенности UI

### Этап 1: Быстрый выбор
- Сетка из 10 цветных карточек
- Переключение между режимами выбора (любимые/нелюбимые)
- Визуальная индикация выбранных цветов (зеленая/красная рамка)
- Таймер 30 секунд

### Этап 2: Ранжирование
- Список цветов с возможностью перетаскивания
- Визуальная индикация позиций (топ-3 зеленые, последние 3 красные)
- Анимация при перетаскивании
- Таймер 60 секунд

### Этап 3: Ассоциации
- Поочередные вопросы с выбором цвета
- Прогресс-бар
- Навигация между вопросами
- Без ограничения по времени

## Расчет результатов

### Психологические шкалы
Каждая шкала рассчитывается на основе:
- Позиций цветов в ранжировании
- Быстрого выбора (любимые/нелюбимые)
- Ассоциаций с аспектами жизни

### Паттерны
Выявляются автоматически на основе комбинаций цветов:
- **Выгорание**: коричневый и серый в топ-3, красный отвергается
- **Тревога**: желтый и красный в топ-2, синий отвергается
- **Депрессия**: серый, черный, коричневый в топ-3
- **Гармония**: зеленый и синий в топ-3, ахроматические цвета не в начале

## Результаты

### Отображаемая информация
1. **8 психологических шкал** с процентами и интерпретациями
2. **Выявленные паттерны** с описаниями и иконками
3. **Цветовые предпочтения** - топ-3 любимых и отвергаемых
4. **Ассоциации** - какие цвета выбраны для разных аспектов
5. **Рекомендации** на основе результатов

### Цветовая индикация
- Шкалы окрашены в зависимости от значений (красный-желтый-зеленый)
- Паттерны имеют предупреждающие цвета для критических состояний
- Карточки рекомендаций выделены цветом

## Технические детали

### Таймеры
- Используется `Timer.periodic` для обратного отсчета
- Автоматический переход при истечении времени
- Визуальная индикация (красный цвет при <10 секунд)

### Drag-and-Drop
- Реализовано через `ReorderableListView`
- Анимация при перетаскивании
- Сохранение порядка в `ColorRankingResult`

### Сохранение результатов
- Результаты сохраняются в формате `ColorPsychologyResult`
- Интеграция с существующей системой через TestProvider (TODO)

## Важные замечания

1. **Специальный тип теста**: Тест не использует стандартную систему вопросов/ответов
2. **Пустой список вопросов**: В TestModel questions = [] для этого теста
3. **Навигация**: Требуется специальная проверка test.id в home_screen.dart
4. **Веса**: Не используется стандартная система весов для personality type
5. **Категория**: Тест относится к категории 'emotional'

## TODO

1. **Сохранение в SharedPreferences**: Интеграция с TestProvider для сохранения результатов
2. **Экспорт результатов**: Функция sharing для отправки результатов
3. **История результатов**: Отслеживание динамики состояния во времени
4. **Кризисные ресурсы**: Добавить контакты психологической помощи при критических паттернах
5. **Weights mapping**: Создать файл color_psychology_weights.dart для интеграции с summary screen

## Статус: ✅ РЕАЛИЗОВАНО
- Полностью функциональный тест с 3 этапами
- Специальный UI с drag-and-drop
- Расчет 8 психологических шкал
- Выявление паттернов
- Детальный экран результатов
- Интеграция с приложением